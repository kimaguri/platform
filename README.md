# SimplX Platform ‚Äî –ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞

–°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –º—É–ª—å—Ç–∏-tenant –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –Ω–∞ –±–∞–∑–µ **Encore.ts** —Å —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π, —Å–∏—Å—Ç–µ–º–æ–π –∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä–æ–≤, –µ–¥–∏–Ω–æ–π —Ç–æ—á–∫–æ–π –≤—Ö–æ–¥–∞ (API Gateway) –∏ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –¥–∞–Ω–Ω—ã—Ö.

---

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ —Å–µ—Ä–≤–∏—Å–∞–º

- [API Gateway](docs/sectioned-docs/gateway.md) ‚Äî –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è, –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ, –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è, –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
- [Tenant Management Service](docs/sectioned-docs/tenant-management.md) ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–µ–Ω–∞–Ω—Ç–∞–º–∏, —Ä–∞—Å—à–∏—Ä—è–µ–º—ã–µ –ø–æ–ª—è, –ø—Ä–∞–≤–∏–ª–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏
- [Data Processing Service](docs/sectioned-docs/data-processing.md) ‚Äî –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö, –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è, –≤–∞–ª–∏–¥–∞—Ü–∏—è, –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å extensible fields
- [Event Management Service](docs/sectioned-docs/event-management.md) ‚Äî —Å–æ–±—ã—Ç–∏–π–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞, –∞—É–¥–∏—Ç, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- [User Management Service](docs/sectioned-docs/user-management.md) ‚Äî –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è, –ø—Ä–æ—Ñ–∏–ª–∏, bootstrap
- [–°–∏—Å—Ç–µ–º–∞ —Ä–∞—Å—à–∏—Ä—è–µ–º—ã—Ö –ø–æ–ª–µ–π –∏ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–æ–≤](docs/sectioned-docs/extensible-fields-dictionary.md) ‚Äî –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –ø–æ–ª—è, —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏, –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è

---

## ‚ú® –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üåê –ï–¥–∏–Ω—ã–π API Gateway
- üîê –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (Encore.ts `authHandler`)
- üîå –°–∏—Å—Ç–µ–º–∞ –∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä–æ–≤ (–∞–¥–∞–ø—Ç–µ—Ä—ã –¥–ª—è –ë–î)
- ‚öôÔ∏è –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å —Ç–∏–ø–∏–∑–∞—Ü–∏–µ–π
- üèóÔ∏è –ú–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–µ—Ä–≤–∏—Å–æ–≤
- üîí –ú—É–ª—å—Ç–∏—Ç–µ–Ω–∞–Ω—Ç–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –∏–∑–æ–ª—è—Ü–∏—è
- üìä –ú–µ—Ç—Ä–∏–∫–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- ‚ö° –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ rate limiting
- üîÑ Entity Conversion Rules ‚Äî –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–∞—è —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
- üì¢ Event-Driven Architecture ‚Äî Pub/Sub, –∞—É–¥–∏—Ç, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- üìã Extensible Fields System ‚Äî –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Å—É—â–Ω–æ—Å—Ç–µ–π
- üìö Dictionary Management ‚Äî –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è, –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏
- üöÄ Bootstrap API ‚Äî –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –æ–¥–Ω–∏–º –∑–∞–ø—Ä–æ—Å–æ–º

---

## üèó –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∞ –ø–æ –ø—Ä–∏–Ω—Ü–∏–ø—É —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –Ω–∞ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ —Å–µ—Ä–≤–∏—Å—ã. –ö–∞–∂–¥—ã–π —Å–µ—Ä–≤–∏—Å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –≤ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–º —Å—Ç–∏–ª–µ, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–∏—Å—Ç–µ–º—É –∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä–æ–≤ –∏ —Ä–µ–∑–æ–ª–≤–µ—Ä–æ–≤, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ä–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å –∏ –∏–∑–æ–ª—è—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö –ø–æ —Ç–µ–Ω–∞–Ω—Ç–∞–º.

–ü–æ–¥—Ä–æ–±–Ω–µ–µ –ø–æ –∫–∞–∂–¥–æ–º—É —Å–µ—Ä–≤–∏—Å—É ‚Äî —Å–º. —Å–µ–∫—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –≤—ã—à–µ.


## ‚ú® Key Features

- **üåê Unified API Gateway** with centralized routing and monitoring
- **üîê Centralized Authentication** via Encore.ts `authHandler`
- **üîå Connector System** with adapter pattern for multiple databases
- **‚öôÔ∏è Configuration Management** with type safety and validation
- **üèóÔ∏è Zonal Architecture** with shared utilities and middleware
- **üîí Multi-Tenant Security** with strict tenant isolation
- **üìä Health Monitoring** and performance metrics
- **‚ö° Caching & Rate Limiting** for optimal performance
- **üéØ TypeScript First** with comprehensive type safety
- **üîÑ Entity Conversion Rules** for intelligent data transformation
- **üì¢ Event-Driven Architecture** with Pub/Sub messaging
- **üìã Extensible Fields System** for dynamic entity customization
- **üìö Dictionary Management** with nested value support
- **üöÄ Bootstrap API** for single-request application initialization

## üèó Architecture Overview

### New Service Structure

```
src/
‚îú‚îÄ‚îÄ config/                     # Centralized configuration system
‚îú‚îÄ‚îÄ connectors/                 # Database adapter pattern
‚îÇ   ‚îú‚îÄ‚îÄ base/                   # Abstract adapters
‚îÇ   ‚îú‚îÄ‚îÄ supabase/              # Supabase implementation
‚îÇ   ‚îî‚îÄ‚îÄ registry/              # Connector factory & resolver
‚îú‚îÄ‚îÄ gateway/                   # API Gateway service
‚îÇ   ‚îú‚îÄ‚îÄ routing/               # Service route definitions
‚îÇ   ‚îú‚îÄ‚îÄ middleware/            # Gateway-specific middleware
‚îÇ   ‚îî‚îÄ‚îÄ src/handlers/          # Health & metrics endpoints
‚îú‚îÄ‚îÄ services/                  # Business microservices
‚îÇ   ‚îú‚îÄ‚îÄ tenant-management/     # Tenant CRUD & configuration
‚îÇ   ‚îú‚îÄ‚îÄ user-management/       # Authentication & user profiles
‚îÇ   ‚îî‚îÄ‚îÄ content-management/    # Entity CRUD with connectors
‚îî‚îÄ‚îÄ shared/                    # Shared utilities & middleware
    ‚îú‚îÄ‚îÄ middleware/            # Auth, tenant, performance
    ‚îú‚îÄ‚îÄ types/                 # Common type definitions
    ‚îî‚îÄ‚îÄ utilities/             # Helpers & validation
```

### Microservices

1. **API Gateway** (`src/gateway/`)

   - Centralized request routing
   - Health monitoring & metrics
   - Cross-cutting concerns (CORS, rate limiting)
   - Service discovery and load balancing
   - Unified endpoint management

2. **Tenant Management** (`src/services/tenant-management/`)

   - Tenant CRUD operations
   - Configuration management
   - Admin database operations
   - Entity conversion rules management
   - Extension field definitions

3. **User Management** (`src/services/user-management/`)

   - Authentication (login, register, logout)
   - User profile management
   - Role-based access control
   - Bootstrap data aggregation

4. **Data Processing** (`src/services/data-processing/`)

   - Entity conversion execution
   - Extensible fields processing
   - Data validation and transformation

6. **Event Management** (`src/services/event-management/`)
   - Event publishing and subscription
   - Audit logging
   - Notification services

### Connector System

```typescript
// Unified database access through adapter pattern
const connector = await registry.getConnectorForTenant(tenantId, getTenantConfig);
const data = await connector.query<User>('users', { filter: { active: true } });

// Support for multiple database types
- Supabase (default)
- PostgreSQL (planned)
- Custom connectors (extensible)
```

### Configuration Management

```typescript
// Centralized, type-safe configuration
import { config } from '@config';

const appConfig = await config.app();
const serviceConfig = await config.services();
const connectorConfig = await config.connectors();

// Environment variable validation
const validation = validateEnvironment();
if (!validation.valid) {
  console.error(validation.errors);
}
```

### Authentication System

```typescript
// Multi-tenant authentication with JWT, API keys, sessions
interface AuthParams {
  authorization?: Header<'Authorization'>;
  tenantId: Header<'X-Tenant-ID'>;
}

export const auth = authHandler<AuthParams, AuthData>(async (params) => {
  // Automatic authentication for all token types
  // Tenant validation and context injection
});
```

### Middleware Stack

```typescript
// Layered middleware for cross-cutting concerns
export default new Service('service-name', {
  middlewares: [
    performanceMiddleware, // Request timing & monitoring
    cachingMiddleware, // Response caching
    tenantValidationMiddleware, // Multi-tenant security
    rateLimitMiddleware, // Rate limiting
  ],
});
```

## üöÄ API Endpoints

### API Gateway (`/api/v1/`)

**Health & Monitoring:**

- `GET /health` - System health check
- `GET /health/:service` - Service-specific health
- `GET /metrics` - Performance metrics
- `GET /metrics/summary` - Metrics summary

**Tenant Management:**

- `GET /tenants` - List tenants
- `GET /tenants/:id` - Get tenant
- `POST /tenants` - Create tenant
- `PUT /tenants/:id` - Update tenant
- `DELETE /tenants/:id` - Delete tenant
- `GET /tenants/extensions/available-tables` - Get available tables
- `GET /tenants/:tenantId/fields` - Get extensible fields
- `GET /tenants/:tenantId/fields/all` - Get all extensible fields for tenant
- `POST /tenants/:tenantId/fields` - Create extensible field
- `PUT /tenants/fields/:fieldId` - Update extensible field
- `DELETE /tenants/fields/:fieldId` - Delete extensible field
- `GET /tenants/extensible-fields/stats` - Get extensible fields statistics
- `GET /tenants/extensible-fields/supported-entities` - Get supported entities

**User Management:**

- `POST /auth/login` - User login
- `POST /auth/register` - User registration
- `POST /auth/logout` - User logout
- `GET /users/me` - Get current user profile
- `PUT /users/me` - Update profile
- `POST /auth/refresh` - Refresh authentication token

**Bootstrap & Configuration:**

- `GET /bootstrap` - Get all application data in one request
- `GET /config` - Get tenant configuration

**Data Processing:**

- `GET /entities/:type` - List entities
- `GET /entities/:type/:id` - Get entity
- `POST /entities/:type` - Create entity
- `PUT /entities/:type/:id` - Update entity
- `DELETE /entities/:type/:id` - Delete entity
- `POST /entities/:type/search` - Search entities with filters
- `GET /entities/:type?select=*, nested_field(*)` - Get entities with nested data

**Entity Conversion:**

- `GET /conversion-rules` - Get conversion rules
- `GET /conversion-rules/:ruleId` - Get conversion rule by ID
- `POST /conversion-rules` - Create conversion rule
- `PUT /conversion-rules/:ruleId` - Update conversion rule
- `DELETE /conversion-rules/:ruleId` - Delete conversion rule
- `POST /conversion/execute` - Execute entity conversion
- `GET /conversion/available/:sourceEntity` - Get available conversion rules
- `POST /conversion/webhooks/record-created` - Webhook for record creation
- `POST /conversion/webhooks/record-updated` - Webhook for record update

**Event Management:**

- `POST /events/publish` - Publish conversion event
- `GET /events/stats` - Get event statistics
- `GET /audit/logs` - Get audit trail
- `GET /notifications/history` - Get notification history

**Dictionary Management:**

- `GET /entities/dictionary` - Get dictionaries
- `GET /entities/dictionary_value` - Get dictionary values
- `GET /entities/dictionary?select=*, dictionary_value(*)` - Get dictionaries with embedded values

### API Gateway (`/api/v1/`)

**Health & Monitoring:**

- `GET /health` - System health check
- `GET /health/:service` - Service-specific health
- `GET /metrics` - Performance metrics
- `GET /metrics/summary` - Metrics summary

**Tenant Management:**

- `GET /tenants` - List tenants
- `GET /tenants/:id` - Get tenant
- `POST /tenants` - Create tenant
- `PUT /tenants/:id` - Update tenant
- `DELETE /tenants/:id` - Delete tenant

**User Management:**

- `POST /auth/login` - User login
- `POST /auth/register` - User registration
- `POST /auth/logout` - User logout
- `GET /users/me` - Get current user profile
- `PUT /users/me` - Update profile

**Content Management:**

- `GET /entities/:type` - List entities
- `GET /entities/:type/:id` - Get entity
- `POST /entities/:type` - Create entity
- `PUT /entities/:type/:id` - Update entity
- `DELETE /entities/:type/:id` - Delete entity

## üîß Configuration

### Environment Variables

The platform uses comprehensive environment configuration. For Docker deployments, environment variables are defined in `docker-compose.yml`.

```bash
# Application
NODE_ENV=development
PORT=4000
HOST=0.0.0.0
LOG_LEVEL=debug

# Database (Legacy - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Encore secrets –¥–ª—è production)
ADMIN_SUPABASE_URL=https://your-project.supabase.co
ADMIN_SUPABASE_SERVICE_KEY=your-service-key
TENANT_CONFIG={"tenant1": {"SUPABASE_URL": "...", "ANON_KEY": "..."}}

# Features
ENABLE_METRICS=true
ENABLE_CACHING=true
ENABLE_RATE_LIMITING=true

# Performance
REQUEST_TIMEOUT=30000
RATE_LIMIT_REQUESTS=100

# CORS
CORS_ORIGINS=["http://localhost:3000", "http://localhost:5173"]
```

### üîê –°–∏—Å—Ç–µ–º–∞ —Å–µ–∫—Ä–µ—Ç–æ–≤ Encore.ts

–î–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–µ–∫—Ä–µ—Ç–∞–º–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ Encore:

**–õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞:**

```bash
# –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª .secrets.local.cue
AdminSupabaseUrl: "https://your-admin-project.supabase.co"
AdminSupabaseServiceKey: "your-service-role-key"
```

**Production/self-host –¥–µ–ø–ª–æ–π:**

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Å–µ–∫—Ä–µ—Ç—ã —á–µ—Ä–µ–∑ CLI –¥–ª—è –≤—Å–µ—Ö –æ–∫—Ä—É–∂–µ–Ω–∏–π
encore secret set --type dev,prod,local,pr AdminSupabaseUrl
encore secret set --type dev,prod,local,pr AdminSupabaseServiceKey
```

üìñ –ü–æ–¥—Ä–æ–±–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ: [`docs/SECRETS_SETUP.md`](docs/SECRETS_SETUP.md)

See `env.example` for complete configuration options.

### üê≥ Docker Deployment

–î–ª—è –∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ Docker –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ docker-compose:

```bash
# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose up -d

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker-compose logs -f

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose down
```

–°–µ—Ä–≤–∏—Å—ã –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –Ω–∞ —Å–ª–µ–¥—É—é—â–∏—Ö –ø–æ—Ä—Ç–∞—Ö:
- API Gateway: 4000
- Tenant Management: 4001 (–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π)
- User Management: 4002 (–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π)
- Data Processing: 4003 (–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π)
- Event Management: 4004 (–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π)

### TypeScript Path Mapping

```typescript
// Convenient imports with path mapping
import { auth } from '@shared/middleware/auth/auth-handler';
import { config } from '@config';
import { DatabaseAdapter } from '@connectors/base/database-adapter';
import { TenantService } from '@services/tenant-management';
```

## üîÑ Entity Conversion System

The platform features a powerful entity conversion system that allows automatic transformation of data between different entity types based on configurable rules.

### Key Features

- **Rule-based Conversion**: Define conversion rules with field mapping and transformation logic
- **Conditional Triggers**: Automatic execution based on record creation/update events
- **Extensible Fields Integration**: Full support for extension fields in conversion rules
- **Audit Trail**: Complete logging of all conversion activities
- **Event-Driven Architecture**: Pub/Sub messaging for conversion events

### Architecture Components

1. **Conversion Rules Storage**: Rules stored in tenant management database
2. **Data Processing Service**: Execution engine for conversions
3. **Gateway Integration**: Unified API endpoints for rule management
4. **Event Management**: Audit logging and notifications

### Example Use Cases

- Convert leads to contacts automatically when status changes
- Transform task data to project data based on completion criteria
- Synchronize data between related entities

## üìö Dictionary Management

The platform includes a comprehensive dictionary management system with support for nested values and advanced querying.

### Features

- **Nested Dictionary Values**: Support for hierarchical dictionary structures
- **Dynamic Field Mapping**: Automatic field name conversion (sort_order ‚Üí order, is_active ‚Üí active)
- **Default Value Support**: Configuration of default dictionary values
- **Bootstrap Integration**: Dictionary data included in application bootstrap

### API Endpoints

- `GET /entities/dictionary` - Get dictionaries with nested values
- `GET /entities/dictionary_value` - Get dictionary values
- `GET /entities/dictionary?select=*, dictionary_value(*)` - Get dictionaries with embedded values

## üöÄ Bootstrap API

Single endpoint to retrieve all essential application data for initialization:

- `GET /bootstrap` - Get user data, dictionaries, config parameters, resources, and permissions

This endpoint significantly reduces frontend initialization requests by providing all necessary data in a single call.
